pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	player = {
		x = 128/2 -8,
		y = 128 - 16,
		w = 16,
		h = 16,
		speed = 2,
		frame = 1,
		anim_dt = 0,
		flip_x = false
	}
	anvils = {}
	score = 0
	game_over = false
end

function _update()
	-- move player
	if btn(0) then
		player.x = max(0, player.x - player.speed)
		player.flip_x = true
		anim_player()
	elseif btn(1) then
		player.x = min(128-16, player.x + player.speed)
		player.flip_x = false
		anim_player()
	else
		player.frame = 1
	end
	
	-- spawn anvils
	if (#anvils < 5 and rnd(100) < 5) then
		add(anvils, {
			x = rnd(120),
			y = 0,
			w = 8,
			h = 8
		})
		score += 1
	end
	
	-- move anvils
	for anvil in all(anvils) do
		anvil.y = anvil.y + 2
		if (anvil.y > 128) then
			del(anvils, anvil)
		end
		
		-- collision
		if check_collision(player,
			anvil) then
				game_over = true
		end
	end
end

function _draw()
	cls(12)
	spr(player.frame, player.x, 
	player.y, 2, 2, player.flip_x)
	for anvil in all(anvils) do
		spr(0, anvil.x, anvil.y,1,1)
	end
	print("score: " .. score
	.. " game over: " .. 
	tostr(game_over)
	, 
		5, 5, 8)
end

function anim_player()
	player.anim_dt = player.anim_dt + 1
	if (player.anim_dt % 2 == 0) then
		player.frame = player.frame + 2
		if player.frame == 7 then
			player.frame = 1
		end
	end
end

function check_collision(a, b)
	return
		a.x < b.x + b.w and
		a.x + a.w > b.x and
		a.y < b.y + b.h and
		a.y + a.h > b.y
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111000000001111000000000014ff410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
155551100000014ff41000000001144ff41000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000
1111110000001144ff4100000001441441100000000014ff41000000000000000000000000000000000000000000000000000000000000000000000000000000
011110000000144144110000000114f55f1000000001144ff4100000000000000000000000000000000000000000000000000000000000000000000000000000
115511000000114f55f1000000014151151000000001441441100000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000001415115100000001641551100000000114f55f100000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000016415511000000177445544100000001615115100000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000174645544100000177477777410000017741551410000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001776477777410000014466444410000017747557741000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000144664444441000015ff66444510000001446644441000000000000000000000000000000000000000000000000000000000000000000000000000
00000000015ff6654444510000011566555110000015ff6644451000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001116655555100000111111115510000011156655511000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000015511155100000155100001100000015511111551000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000016550145501455013550135501255012550125501155011550105500f5500f5500a5000a5000950008500075000050000500005000050000500005000050000500005000050000500005000050000500
