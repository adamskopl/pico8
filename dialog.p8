pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
cfg = {
	mar = 2,
	txt_on_c = 17,
	txt_off_c = 5,
	bg = 6
}

delta=0
last_t=0

anim = {
	create = function(n, x, y, f_x)
		printh(x)
		return {
			start_n = n,
			n = n,
			x = x,
			y = y,
			f_x = f_x,
			dt = 0,
			fin = true
		}
	end,
	start = function(self)
		self.fin = false
	end,
	update = function(self)
		if (self.fin) then return end
		self.dt += delta
		if (self.dt > 0.08) then
			self.dt = 0;
			self.n += 2; --sprite 16px
			if (self.n == self.start_n + 4) then
				self.n = self.start_n
			end
		end
	end,
	draw = function(self)
		spr(self.n, self.x, self.y, 2, 2, self.f_x)
	end
}

text={
	create = function(t, x, y, c)
		return {
			t = "",
			t_fin = t,
			x = x,
			y = y,
			c = c,
			t_pos = 0,
			delta = 0,
			fin = true,
		}
	end,
	start = function(self, anim)
		if (anim) then
			sfx(0)
			self.fin = false
		else
			self.t = self.t_fin
		end
	end,
	update = function(self)
		if (self.fin) then return end
		self.delta += delta
		if (self.delta > 0.05) then
			self.delta = 0
			self.t_pos += 2
			self.t = sub(self.t_fin, 0, self.t_pos)
			if (self.t_pos > #self.t_fin) then
				self.fin = true
				sfx(0, -2)
				return
			end 
		end
	end,
	draw = function(self)
		print(self.t, self.x, self.y, self.c)
	end
}

-->8
-- dialog

mess_print = 2 -- 1 or 2.

mess_1=[[
let's start with something
simple.
]]

mess_2=[[
yes, let's do it so.
]]

-->8
-- declarations

local c1, c2 = cfg.txt_off_c, cfg.txt_on_c
if mess_print == 1 then
	c1, c2 = c2, c1
end
text1 = text.create(mess_1, 2 * cfg.mar + 16, cfg.mar, c1)
anim1 = anim.create(0, cfg.mar, cfg.mar, false)

text2 = text.create(mess_2, cfg.mar, 63 + cfg.mar, c2)
anim2 = anim.create(32, 128 - cfg.mar - 16, 63 + cfg.mar, true)

-->8
-- main
function _init()
	if (mess_print == 1) then
		anim.start(anim1)
		text.start(text1, true)
		text.start(text2, false)
	else
		text.start(text1, false)
		anim.start(anim2)
		text.start(text2, true)
	end
end

function _update()
	delta=time()-last_t
	last_t=time()
	
	text.update(text1)
	anim1.fin = text1.fin
	anim.update(anim1)
	
	text.update(text2)
	anim2.fin = text2.fin
	anim.update(anim2)
end

function _draw()
	cls(cfg.bg)
--	rect(2 * cfg.mar + 16, cfg.mar, 127 - cfg.mar, 64 - cfg.mar, 2)
--	rect(cfg.mar, 63 + cfg.mar, 127 - cfg.mar * 2 - 16, 128 - cfg.mar, 2)
	
	text.draw(text1)
	anim.draw(anim1)
	
	text.draw(text2)
	anim.draw(anim2)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000014ff410000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001144ff4100000000014ff41000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00014414411000000001144ff4100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000114f55f1000000001441441100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001415115100000000114f55f100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00016415511000000001415115100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00174645544100000017641551100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01776477777410000177464554410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01446644444410000144667777741000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15ff66544445100015ff664444441000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01116655555100000111665444451000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00015511155100000001555555510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00013333310000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00133333331100000013333331010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00133334431510000013333333151000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0173331ff11751000013333443175100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
176533f55f1715100171331ff1171510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0155335115171510176533f55f171510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0013531551374f100153335115374f10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0133353113374f100133531551374f10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01331111111715100133353113171510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01f433333317510001f4111111175100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111111111510000011333333151000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00015511551100000001551155110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200042b3733131332313373732730317303153031b3031b3031a3030f3032a3032a3032a303293032930300303003030030300303003030030300303003030030300303003030030300303003030030300300
__music__
00 00024344

